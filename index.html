<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grand Luxury Carousel</title>
    <!-- 使用最稳定的 CDN 引入基础 Three.js -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; background: #050300; font-family: serif; overflow: hidden; color: white; }
        canvas { display: block; width: 100vw; height: 100vh; }
        #ui-layer { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; }
        .interactive { pointer-events: auto; }
        #loader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #050300; display: flex; flex-direction: column;
            align-items: center; justify-content: center; z-index: 100;
            color: #D4AF37; transition: opacity 0.8s ease;
        }
        .spinner { width: 40px; height: 40px; border: 3px solid rgba(212, 175, 55, 0.1); border-top-color: #D4AF37; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div id="loader">
        <div class="spinner"></div>
        <p style="margin-top: 20px; letter-spacing: 0.3em; font-size: 10px;">LOADING ROYAL ASSETS...</p>
    </div>

    <div id="ui-layer">
        <div class="absolute top-10 w-full text-center">
            <h1 class="text-4xl md:text-6xl text-yellow-500 tracking-[0.3em] font-serif italic uppercase opacity-80">Grand Carousel</h1>
        </div>
        <div class="absolute bottom-10 left-1/2 -translate-x-1/2 flex gap-4 interactive">
            <button id="btn-chaos" class="px-8 py-2 rounded-full border border-yellow-500/50 text-white text-[10px] uppercase tracking-widest hover:bg-red-900/30 transition-all">Unleash Chaos</button>
            <button id="btn-restore" class="px-8 py-2 rounded-full bg-yellow-600 text-black text-[10px] uppercase tracking-widest font-bold shadow-lg hover:bg-yellow-500 transition-all">Restore Order</button>
        </div>
    </div>

    <script>
        // --- 初始化场景 ---
        let scene, camera, renderer, carouselGroup, core, particles;
        let isChaos = false;
        const boxes = [];
        const boxCount = 50;

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x050300);
            scene.fog = new THREE.Fog(0x050300, 10, 50);

            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 5, 25);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            document.body.appendChild(renderer.domElement);

            // --- 灯光 ---
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.4);
            scene.add(ambientLight);

            const spotLight = new THREE.SpotLight(0xffd700, 2);
            spotLight.position.set(10, 20, 10);
            scene.add(spotLight);

            // --- 核心能量球 ---
            const coreGeo = new THREE.SphereGeometry(2, 32, 32);
            const coreMat = new THREE.MeshStandardMaterial({ 
                color: 0xffd700, 
                emissive: 0xff4500, 
                emissiveIntensity: 1.5,
                metalness: 1,
                roughness: 0
            });
            core = new THREE.Mesh(coreGeo, coreMat);
            core.position.y = 5;
            scene.add(core);

            // --- 旋转木马元素 ---
            carouselGroup = new THREE.Group();
            scene.add(carouselGroup);

            const boxGeo = new THREE.BoxGeometry(0.5, 1, 0.5);
            const boxMat = new THREE.MeshStandardMaterial({ color: 0xd4af37, metalness: 0.9, roughness: 0.1 });

            for (let i = 0; i < boxCount; i++) {
                const mesh = new THREE.Mesh(boxGeo, boxMat);
                const angle = (i / boxCount) * Math.PI * 2;
                const radius = 8 + Math.random() * 2;
                
                // 初始数据
                mesh.userData = {
                    angle: angle,
                    radius: radius,
                    y: (Math.random() - 0.5) * 8,
                    chaosPos: new THREE.Vector3((Math.random()-0.5)*40, (Math.random()-0.5)*40, (Math.random()-0.5)*40),
                    chaosRot: new THREE.Vector3(Math.random()*Math.PI, Math.random()*Math.PI, Math.random()*Math.PI)
                };
                
                carouselGroup.add(mesh);
                boxes.push(mesh);
            }

            // --- 金粉粒子 ---
            const pGeo = new THREE.BufferGeometry();
            const pCoords = [];
            for(let i=0; i<1000; i++) {
                pCoords.push((Math.random()-0.5)*50, (Math.random()-0.5)*50, (Math.random()-0.5)*50);
            }
            pGeo.setAttribute('position', new THREE.Float32BufferAttribute(pCoords, 3));
            const pMat = new THREE.PointsMaterial({ color: 0xffd700, size: 0.05, transparent: true, opacity: 0.5 });
            particles = new THREE.Points(pGeo, pMat);
            scene.add(particles);

            // --- 事件绑定 ---
            document.getElementById('btn-chaos').onclick = () => isChaos = true;
            document.getElementById('btn-restore').onclick = () => isChaos = false;
            window.addEventListener('resize', onWindowResize);

            // 隐藏加载层
            setTimeout(() => {
                const loader = document.getElementById('loader');
                loader.style.opacity = '0';
                setTimeout(() => loader.style.display = 'none', 800);
            }, 1000);

            animate();
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);
            const time = Date.now() * 0.001;

            // 核心动画
            core.scale.setScalar(1 + Math.sin(time * 2) * 0.1);
            core.position.y = 5 + Math.sin(time) * 0.5;

            // 盒子动画
            boxes.forEach((box, i) => {
                const data = box.userData;
                if (isChaos) {
                    box.position.lerp(data.chaosPos, 0.05);
                    box.rotation.x += 0.02;
                    box.rotation.y += 0.01;
                } else {
                    const currentAngle = data.angle + time * 0.5;
                    const targetPos = new THREE.Vector3(
                        Math.cos(currentAngle) * data.radius,
                        data.y + Math.sin(time + i) * 0.5,
                        Math.sin(currentAngle) * data.radius
                    );
                    box.position.lerp(targetPos, 0.05);
                    box.rotation.set(0, -currentAngle + Math.PI/2, 0);
                }
            });

            // 粒子缓慢旋转
            particles.rotation.y += 0.001;

            // 整个场景缓慢旋转
            carouselGroup.rotation.y += 0.002;

            renderer.render(scene, camera);
        }

        // 启动
        window.onload = init;
    </script>
</body>
</html>
